#!/usr/bin/env bash
# ==============================================================================
# UKE Backup v7.2 - Comprehensive System State Backup
# ==============================================================================
set -euo pipefail

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
export UKE_ROOT="${SCRIPT_DIR%/bin}"

if [[ -f "$SCRIPT_DIR/../lib/core.sh" ]]; then
    source "$SCRIPT_DIR/../lib/core.sh"
else
    ok() { echo "OK: $*"; }
    info() { echo "INFO: $*"; }
fi

BACKUP_DIR="${XDG_DATA_HOME:-$HOME/.local/share}/uke/backups"

create_backup() {
    local timestamp=$(date +%Y-%m-%d_%H%M%S)
    local path="$BACKUP_DIR/$timestamp"
    mkdir -p "$path"
    
    info "Backing up configs..."
    [[ -d "$UKE_ROOT" ]] && cp -r "$UKE_ROOT" "$path/uke"
    
    ok "Backup created at $path"
}

list_backups() {
    ls "$BACKUP_DIR"
}

case "${1:-create}" in
    create) create_backup ;;
    list)   list_backups ;;
    *)      echo "Usage: uke-backup [create|list]" ;;
esac
