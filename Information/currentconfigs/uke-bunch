#!/usr/bin/env bash
# =============================================================================
# UKE v8 - uke-bunch
# Environment presets that launch apps and focus workspaces
# Triggered by: Cmd+Ctrl+1-5 (macOS) / Alt+Ctrl+1-5 (Linux)
# =============================================================================

set -euo pipefail

# -----------------------------------------------------------------------------
# OS Detection
# -----------------------------------------------------------------------------
case "$(uname -s)" in
    Darwin) OS="macos" ;;
    Linux)  OS="linux" ;;
    *)      echo "Unsupported OS"; exit 1 ;;
esac

# -----------------------------------------------------------------------------
# Helpers
# -----------------------------------------------------------------------------
open_app() {
    local app="$1"
    if [[ "$OS" == "macos" ]]; then
        open -a "$app" 2>/dev/null &
    else
        # Linux: use the command name (usually lowercase)
        local cmd="${app,,}"  # lowercase
        # Handle special cases
        case "$app" in
            "Brave Browser") cmd="brave" ;;
            "Visual Studio Code"|"Code") cmd="code" ;;
            "WezTerm") cmd="wezterm" ;;
            "Obsidian") cmd="obsidian" ;;
            "Spotify") cmd="spotify" ;;
            "Preview"|"Zathura") cmd="zathura" ;;
            "Mail"|"Thunderbird") cmd="thunderbird" ;;
        esac
        $cmd 2>/dev/null &
    fi
}

focus_workspace() {
    local ws="$1"
    if [[ "$OS" == "macos" ]]; then
        yabai -m space --focus "$ws"
    else
        hyprctl dispatch workspace "$ws"
    fi
}

# -----------------------------------------------------------------------------
# Bunches
# -----------------------------------------------------------------------------
bunch_study() {
    echo "ðŸŽ“ Launching Study environment..."
    open_app "Obsidian"
    open_app "Brave Browser"
    open_app "WezTerm"
    open_app "Preview"
    sleep 1
    focus_workspace 2
}

bunch_guitar() {
    echo "ðŸŽ¸ Launching Guitar environment..."
    open_app "Spotify"
    open_app "Brave Browser"
    sleep 1
    focus_workspace 7
}

bunch_coding() {
    echo "ðŸ’» Launching Coding environment..."
    open_app "WezTerm"
    open_app "Code"
    open_app "Brave Browser"
    sleep 1
    focus_workspace 3
}

bunch_email() {
    echo "ðŸ“§ Launching Email environment..."
    open_app "Mail"
    open_app "Slack"
    open_app "Brave Browser"
    sleep 1
    focus_workspace 9
}

bunch_reading() {
    echo "ðŸ“š Launching Reading environment..."
    open_app "Preview"
    open_app "Obsidian"
    sleep 1
    focus_workspace 5
}

# -----------------------------------------------------------------------------
# Usage & Dispatch
# -----------------------------------------------------------------------------
usage() {
    cat <<EOF
Usage: uke-bunch <bunch-name>

Available bunches:
  study    - Obsidian, Brave, WezTerm, Preview â†’ WS 2
  guitar   - Spotify, Brave â†’ WS 7
  coding   - WezTerm, Code, Brave â†’ WS 3
  email    - Mail, Slack, Brave â†’ WS 9
  reading  - Preview, Obsidian â†’ WS 5

Aliases (by number):
  1 = study
  2 = guitar
  3 = coding
  4 = email
  5 = reading

Examples:
  uke-bunch study
  uke-bunch 1
  uke-bunch coding
EOF
}

case "${1:-}" in
    study|1)   bunch_study ;;
    guitar|2)  bunch_guitar ;;
    coding|3)  bunch_coding ;;
    email|4)   bunch_email ;;
    reading|5) bunch_reading ;;
    list|-l)   usage ;;
    ""|help|-h|--help) usage ;;
    *)
        echo "Unknown bunch: $1"
        usage
        exit 1
        ;;
esac
