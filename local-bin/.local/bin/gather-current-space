#!/bin/bash

# Gather all windows to the current space (Cross-Platform)

detect_os() {
    if [[ "$OSTYPE" == "darwin"* ]]; then
        echo "macos"
    elif [[ "$OSTYPE" == "linux-gnu"* ]]; then
        echo "linux"
    else
        echo "unknown"
    fi
}

OS=$(detect_os)

if [[ "$OS" == "macos" ]]; then
    if ! command -v yabai &> /dev/null; then echo "Error: yabai missing"; exit 1; fi
    
    CURRENT_SPACE=$(yabai -m query --spaces --space | jq '.index')
    echo "üçè macOS: Gathering windows to Space $CURRENT_SPACE..."
    
    # Yabai Logic
    yabai -m query --windows | jq -r ".[] | select(.space != $CURRENT_SPACE) | .id" | \
    xargs -I{} yabai -m window {} --space "$CURRENT_SPACE"

elif [[ "$OS" == "linux" ]]; then
    if ! command -v hyprctl &> /dev/null; then echo "Error: hyprctl missing"; exit 1; fi
    
    # Hyprland Logic
    # Get current workspace ID
    CURRENT_WS=$(hyprctl activeworkspace -j | jq '.id')
    echo "üêß Linux: Gathering windows to Workspace $CURRENT_WS..."
    
    # Get list of all window addresses on other workspaces
    hyprctl clients -j | jq -r ".[] | select(.workspace.id != $CURRENT_WS) | .address" | \
    while read -r addr; do
        hyprctl dispatch movetoworkspacesilent "$CURRENT_WS,address:$addr"
    done
fi

echo "‚úÖ Done."
